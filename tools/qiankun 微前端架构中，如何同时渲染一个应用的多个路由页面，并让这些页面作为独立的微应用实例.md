> æœ¬æ–‡åŸæ–‡åœ°å€ [purefunction.xyz](https://purefunction.xyz/microapp-multiple)

> å¤ªé•¿ä¸çœ‹ï¼Œè¯´é‡ç‚¹ğŸ‘‡ï¼š é—®é¢˜ï¼šå¾®å‰ç«¯æ¶æ„ä¸­ï¼Œå¦‚ä½•åŒæ—¶æ¸²æŸ“ä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªè·¯ç”±é¡µé¢ï¼Œå¹¶è®©è¿™äº›é¡µé¢ä½œä¸ºç‹¬ç«‹çš„å¾®åº”ç”¨å®ä¾‹ï¼Ÿ è§£å†³ï¼šé›†æˆ qiankun.jsï¼Œç”¨ loadMicroApp æ–¹æ³•æ‰‹åŠ¨åŠ è½½å­åº”ç”¨ï¼Œå­......

å¤ªé•¿ä¸çœ‹ï¼Œè¯´é‡ç‚¹ğŸ‘‡ï¼š
-----------

é—®é¢˜ï¼šå¾®å‰ç«¯æ¶æ„ä¸­ï¼Œå¦‚ä½•åŒæ—¶æ¸²æŸ“_ä¸€ä¸ªåº”ç”¨_çš„å¤šä¸ªè·¯ç”±é¡µé¢ï¼Œå¹¶è®©è¿™äº›é¡µé¢ä½œä¸º_ç‹¬ç«‹_çš„å¾®åº”ç”¨å®ä¾‹ï¼Ÿ

è§£å†³ï¼šé›†æˆ qiankun.jsï¼Œç”¨ `loadMicroApp` æ–¹æ³•æ‰‹åŠ¨åŠ è½½å­åº”ç”¨ï¼Œå­åº”ç”¨æ¯æ¬¡æ¸²æŸ“**åˆ›å»ºæ–°çš„åº”ç”¨å®ä¾‹**ï¼Œå¹¶é‡‡ç”¨**å†…å­˜è·¯ç”±**æ–¹æ¡ˆåšé¡µé¢çš„åŒ¹é…å’Œè·³è½¬ã€‚

åºŸè¯å°‘è¯´ï¼Œshow me the code ğŸ‘‡ğŸ‘‡ï¼š
---------------------------

[ğŸ”¥DEMOğŸ”¥](https://github.com/hoomjac/micro-frontend-example)

èƒŒæ™¯
--

å…¬å¸æœ‰ä¸€ä¸ªå¹³å°å‹åº”ç”¨ï¼Œåƒè¿™æ ·ï¼š

![](https://i.typlog.com/purefunction/8349465254_978814.png)

å·¦è¾¹çš„ä¸€çº§èœå•å¯¹åº”çš„æ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼ŒäºŒçº§èœå•å¯¹åº”çš„æ˜¯è¯¥åº”ç”¨çš„ä¸åŒè·¯ç”±é¡µé¢ã€‚ç‚¹å‡»äºŒçº§èœå•æ—¶ï¼Œé¡µé¢ä¸­é—´çš„ iframe ä¼šåŠ è½½è¿™ä¸ªåº”ç”¨çš„æŸä¸ªè·¯ç”±é¡µé¢ã€‚æ¯ä¸ª**å­åº”ç”¨**æ”¯æŒç‹¬ç«‹éƒ¨ç½²ä½¿ç”¨ï¼Œç‹¬ç«‹ä½¿ç”¨æ—¶ï¼Œå­åº”ç”¨ä¼šå‡ºç°ä¾§è¾¹èœå•ï¼Œå³åº”ç”¨çš„ä¸åŒè·¯ç”±é¡µé¢ï¼Œåƒè¿™æ ·ï¼š

![](https://i.typlog.com/purefunction/8349465232_123548.png)

So far so goodã€‚iframe ä½œä¸ºå¾®å‰ç«¯æ–¹æ¡ˆä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆä¸å¦¥ï¼Œä¸Šçº¿è¿è¡Œè‰¯å¥½ã€‚

ä½†æ˜¯ï¼Œå½“é‡åˆ°éœ€è¦åœ¨ä¸åŒé¡µé¢ä¹‹é—´æ¥å›è·³è½¬çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ A åº”ç”¨åšä¸€ä¸ªæŸ¥è¯¢ï¼Œç„¶åè·³åˆ° B åº”ç”¨æ”¹ä¸€ä¸ªå€¼ï¼Œæ¥ç€åˆè¦å›åˆ° A é¡µé¢æ“ä½œä¸€ä¸‹ï¼Œå†åˆ° B...ã€‚ç”±äºä¸­é—´çš„ iframe åŒä¸€æ—¶é—´åªèƒ½æ˜¾ç¤ºä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥åœ¨æ¥å›åˆ‡æ¢çš„æ—¶å€™æ¯æ¬¡éƒ½éœ€è¦åˆå§‹åŒ–åº”ç”¨ï¼Œå¯¼è‡´åº”ç”¨çš„æ“ä½œçŠ¶æ€æ— æ³•ä¿å­˜ï¼Œä½“éªŒä½¿äººå´©æºƒã€‚

è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å• -- **åŠ å…¥ Tab é¡µç­¾**ã€‚æ¯æ¬¡ç‚¹å‡»èœå•ï¼ŒæŠŠè¯¥åº”ç”¨ / é¡µé¢åŠ è½½åˆ°ä¸€ä¸ª Tab é¡µç­¾ä¸‹ï¼Œå°±åƒæµè§ˆå™¨çš„é¡µç­¾ä¸€æ ·ï¼Œæ¥å›åˆ‡æ¢æ—¶èƒ½ä¿ç•™ä½é¡µé¢çš„æ“ä½œçŠ¶æ€ï¼Œä¾¿äºè·³è½¬ã€å¯¹æ¯”ã€æŸ¥çœ‹ã€æ“ä½œã€‚

![](https://i.typlog.com/purefunction/8349465225_552876.png)

ç”±äºå¼•å…¥äº†å¤šé¡µç­¾è®¾è®¡ï¼Œæ¯ä¸ªé¡µç­¾éƒ½éœ€è¦ä¸€ä¸ª iframe ä½œä¸ºåº”ç”¨å®¹å™¨ï¼Œä½“éªŒå°±å‡ºç°é—®é¢˜äº†ï¼Œé¡µç­¾å¼€å¤šäº†å¡åˆ°æŠ‘éƒï¼Œè€Œä¸”ä¸€ä¸ªé¡µç­¾å…³é—­åé‡æ–°æ‰“å¼€ï¼Œåˆè¦é‡æ–°åˆå§‹åŒ– iframeã€‚äºæ˜¯å†³å®šä½¿ç”¨ qiankun.js åšå¾®å‰ç«¯æ”¹é€ ã€‚

åŒä¸€åº”ç”¨åŠ è½½å¤šä¸ªå®ä¾‹
----------

qiankun.js åŸºäºè·¯ç”±çš„é…ç½®ï¼Œå³ä¸€ä¸ªè·¯ç”±åœ°å€å¯¹åº”ä¸€ä¸ªåº”ç”¨ï¼Œä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å› ä¸ºæˆ‘ä»¬æœ‰å¤šä¸ªé¡µç­¾ï¼Œä¸åŒé¡µç­¾ä¸‹æ¸²æŸ“çš„å¯èƒ½æ˜¯åŒä¸€ä¸ªåº”ç”¨çš„ä¸åŒè·¯ç”±é¡µé¢ï¼Œè€Œæµè§ˆå™¨çš„åœ°å€åªæœ‰ä¸€ä¸ªï¼Œä¼šé€ æˆæ¸²æŸ“å†²çªï¼šå‡å¦‚ã€Œé¡µç­¾ 1ã€å’Œã€Œé¡µç­¾ 2ã€æ˜¯åŒä¸€ä¸ªåº”ç”¨çš„ä¸åŒè·¯ç”±é¡µé¢ï¼Œå½“åœ°å€åŒ¹é…åˆ°é¡µç­¾ 1 æ—¶ï¼Œé¡µç­¾ 2 ä¹ŸåŒæ ·å—åˆ°åœ°å€æ”¹å˜çš„å½±å“ï¼Œä»è€Œè·³è½¬åˆ°é¡µç­¾ 1 çš„è·¯ç”±é¡µé¢ã€‚æ¯•ç«Ÿæ˜¯åŒä¸€ä¸ªåº”ç”¨ï¼Œè®¤çš„æ˜¯åŒä¸€ä¸ªåœ°å€æ ã€‚

é’ˆå¯¹æ­¤ï¼Œqiankun.js çš„æ–‡æ¡£ä¸Šä¹Ÿè¯´å¾—å¾ˆæ¸…æ¥šäº†ï¼š

> [åŒæ—¶å­˜åœ¨å¤šä¸ªå¾®åº”ç”¨æ—¶](https://qiankun.umijs.org/zh/cookbook#%E5%90%8C%E6%97%B6%E5%AD%98%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%BE%AE%E5%BA%94%E7%94%A8%E6%97%B6)ï¼Œå¦‚æœè¿™äº›å¾®åº”ç”¨éƒ½æœ‰è·¯ç”±è·³è½¬çš„éœ€æ±‚ï¼Œè¦ä¿è¯è¿™äº›è·¯ç”±èƒ½äº’ä¸å¹²æ‰°ï¼Œéœ€è¦ä½¿ç”¨ memory è·¯ç”±ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡è·¯ç”±é…ç½®çš„æ–¹å¼åŠ è½½å­åº”ç”¨äº†ï¼Œé‚£å°±æ‰‹åŠ¨è°ƒç”¨ qiankun æä¾›çš„`loadMicroApp` APIï¼›å…¶æ¬¡ï¼Œæ¯ä¸€ä¸ªé¡µç­¾ä¸‹çš„å­åº”ç”¨ï¼Œéœ€è¦æ˜¯å®Œå…¨ç‹¬ç«‹çš„åº”ç”¨å®ä¾‹ï¼Œäº’ä¸å½±å“ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨åŸºäºåœ°å€æ çš„è·¯ç”±æ–¹æ¡ˆï¼Œåªèƒ½ç”¨**å†…å­˜è·¯ç”±**æ¥åŒ¹é…é¡µé¢ã€‚

> æ‰€è°“å†…å­˜è·¯ç”±ï¼Œå°±æ˜¯ä¸æ˜¾ç¤ºåœ¨åœ°å€æ çš„è·¯ç”±ï¼Œè·¯ç”±è¡¨ä½œä¸ºå†…å­˜å˜é‡ç»´æŠ¤åœ¨åº”ç”¨ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ·æ–°ä¸€ä¸‹å°±æ²¡äº†ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥åšæŒä¹…åŒ–ï¼‰ã€‚æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„è·¯ç”±åº“ï¼Œé™¤äº†æä¾›å¸¸ç”¨çš„ hash è·¯ç”±æˆ– histroy è·¯ç”±çš„æ–¹æ¡ˆï¼Œä¹Ÿéƒ½æä¾›äº†å†…å­˜è·¯ç”±æ–¹æ¡ˆã€‚æ¯ä¸ªåº“å¯èƒ½å‘½åä¸åŒï¼Œæ¯”å¦‚åœ¨ `Vue Router 4.x` ä¸­ï¼Œé€šè¿‡ `createMemoryHistory` å¯ä»¥åˆ›å»ºå†…å­˜è·¯ç”±ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œæ•´ä½“æµç¨‹æ˜¯è¿™æ ·çš„ï¼šç‚¹å‡»èœå•é¡¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ tab æ ‡ç­¾é¡µï¼Œè°ƒç”¨ `loadMicroApp` ï¼Œä¼ å…¥å¯¹åº” pathï¼Œæ¯”å¦‚ `/childA/page1`ã€‚åœ¨å­åº”ç”¨ childA ä¸­ï¼Œæ”¶åˆ°è¿™ä¸ª pathï¼Œäºæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨å®ä¾‹ï¼ˆå¦‚ Vue3 çš„ createAppï¼‰ï¼Œå¹¶ä¸”è·³è½¬åˆ° `/page1` å¯¹åº”çš„è·¯ç”±é¡µé¢ã€‚ç”±äºä½¿ç”¨çš„æ˜¯å†…å­˜è·¯ç”±ï¼Œåœ°å€æ ä¸Šçš„åœ°å€ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚æ¥ç€ï¼Œç‚¹å‡»å¦ä¸€ä¸ªèœå•é¡¹ `/childA/page2`ï¼Œå†å»ºä¸€ä¸ªæ ‡ç­¾é¡µï¼Œå­åº”ç”¨ childA å†æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨å®ä¾‹ï¼ˆå’Œå‰é¢é‚£ä¸ªå®Œå…¨æ— å…³ï¼‰ï¼Œå¹¶ä½¿ç”¨å†…å­˜è·¯ç”±è·³è½¬åˆ°äº† `/page2` å¯¹åº”çš„é¡µé¢...

ä»£ç å®ç°
----

**ä½¿ç”¨ Vue3+TypeScript ä¸ºä¾‹ï¼Œå…¶ä»–æ¡†æ¶åŒç†ã€‚**

é¦–å…ˆï¼Œå‚è€ƒ qiankun [å®˜æ–¹æ–‡æ¡£](https://qiankun.umijs.org/zh/guide/tutorial)ï¼Œä¸»åº”ç”¨è£…å¥½ç›¸å…³ä¾èµ–ï¼Œå­åº”ç”¨é…ç½®å¥½ webpackï¼ŒpublicPathï¼Œæš´éœ²å‡ºé’©å­æ–¹æ³•... åœ¨æ­¤ä¸èµ˜è¿°ã€‚

è¯´å‡ ä¸ªé‡ç‚¹ï¼š

### ä¸»åº”ç”¨

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå…ˆå°è£…ä¸€ä¸ª `useMicroApp` æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨ qiankun çš„ API

```
// src/utils/useMicroApp.ts


import { LoadableApp, loadMicroApp, MicroApp, ObjectType } from 'qiankun'


import NProgress from 'nprogress'


import '../styles/nprogress.css'


export function useMicroApp() {


  // ç»´æŠ¤ä¸€ä¸ª appMapï¼Œä½œä¸ºåº”ç”¨å®ä¾‹ç¼“å­˜


  const appMap: { [k: string]: MicroApp } = {}


  // å°è£… loadMicroApp æ–¹æ³•ï¼ŒåŠ ç‚¹æ–™


  const loadApp = (app: LoadableApp<ObjectType>) => {


		// åŠ è½½å­åº”ç”¨å‰ï¼Œå‡ºç°åŠ è½½è¿›åº¦æ¡


    NProgress.start()


    // è°ƒç”¨ loadMicroApp æ–¹æ³•ï¼Œä¼ å…¥å‚æ•°


    const newApp = loadMicroApp(app)


    // å°†æ–°çš„å¾®åº”ç”¨å®ä¾‹å­˜å…¥ appMap


    appMap[app.name] = newApp


    // åº”ç”¨åŠ è½½ç»“æŸæˆ–é”™è¯¯æ—¶ï¼Œå…³é—­åŠ è½½è¿›åº¦æ¡


    newApp.mountPromise


      .then(() => {


        NProgress.done()


      })


      .catch(() => NProgress.done())


  }


  // è¿”å› appMap å’Œ loadApp


  return {


    loadApp,


    appMap


  }


}


```

èœå•çš„æ•°æ®é•¿è¿™æ ·ğŸ‘‡ï¼š

```
export const mockMenu = [


  {


    path: 'childA',


    id: 'suygdf786qadf8a8sf8af878d7fa',


    name: 'å­åº”ç”¨A',


    entry: '//localhost:10001',


    children: [


      {


        path: 'child-a/page1',


        id: 'f083bcc9f0ea4a7c8e4cf30dfb066f93',


        name: 'é¡µé¢1',


        entry: '//localhost:10001'


      },


      {


        path: 'child-a/page2',


        id: 'ab34b1b1feab4f5abf950d1c9999c46d',


        name: 'é¡µé¢2',


        entry: '//localhost:10001'


      },


      {


        path: 'child-a/page3',


        id: 'aef8d6903a7e4db0b04b96d1403d406c',


        name: 'é¡µé¢3',


        entry: '//localhost:10001'


      }


    ]


  }


]


```

èœå•ç‚¹å‡»çš„å¤„ç†é€»è¾‘ï¼š

```
// src/App.vue


setup() {


    const menuList = ref<MenuList>(mockMenu)


    const { loadApp, appMap } = useMicroApp()


    const panes = ref<{ title: string; key: string; [k: string]: any }[]>([])


    const activePaneKey = ref(


      panes.value.length ? panes.value[0].key : undefined


    )


    async function handleClick(item: MenuItem) {


      const appId = item.id


      const isPaneExist = panes.value.some(p => p.key === appId)


      const microApp = appMap[appId]


      // å¦‚æœæ ‡ç­¾å·²ç»å­˜åœ¨ï¼Œåˆ‡æ¢åˆ°å¯¹åº”æ ‡ç­¾


      if (isPaneExist) {


        activePaneKey.value = appId


        return


      }


      // ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„æ ‡ç­¾ï¼Œå¹¶æ¿€æ´»æ ‡ç­¾ï¼Œç„¶åæ¸²æŸ“å¾®åº”ç”¨


      panes.value.push({


        title: item.name,


        key: appId


      })


      // æ¿€æ´»æ–°çš„é¡µç­¾


      activePaneKey.value = appId


      // åœ¨ä¸‹ä¸€ä¸ª tick æ‰§è¡ŒåŠ è½½å¾®åº”ç”¨çš„é€»è¾‘ï¼Œç¡®ä¿ DOM å®¹å™¨ç”Ÿæˆäº†


      await nextTick()


      if (microApp) {


        // å¦‚æœå­åº”ç”¨æ³¨å†Œè¿‡äº†ï¼Œé‡æ–°mountä¸€ä¸‹å°±å¥½


        microApp.mount()


      } else {


        // é¦–æ¬¡åŠ è½½ï¼Œæ³¨å†Œå¹¶åŠ è½½å­åº”ç”¨ã€‚ä¼ å…¥ path ä¾›å­åº”ç”¨ä½œè·¯ç”±è·³è½¬


        loadApp({


          name: appId,


          entry: item.entry,


          container: `#${appId}`,


          props: {


            path: item.path


          }


        })


      }


    }


}


// ...


```

å…³é—­é¡µç­¾æ—¶ï¼Œå¸è½½åº”ç”¨ï¼š

```
// src/App.vue


function onPaneEdit(


      targetKey: string | MouseEvent,


      action: 'remove' | 'add'


    ) {


      if (typeof targetKey === 'string' && action === 'remove') {


        appMap[targetKey].unmount().then(() => {


          removePane(targetKey)


        })


      }


    }


```

### å­åº”ç”¨

è·¯ç”±è¡¨é…ç½®ï¼š

```
import { createRouter, Router, RouterHistory } from 'vue-router'


export const routes = [


  {


    path: '/',


    component: () => import('../views/Page1.vue')


  },


  {


    path: '/page1',


    component: () => import('../views/Page1.vue')


  },


  {


    path: '/page2',


    component: () => import('../views/Page2.vue')


  },


  {


    path: '/page3',


    component: () => import('../views/Page3.vue')


  }


]


// å¯¼å‡ºä¸€ä¸ª createRouterByHistory æ–¹æ³•


export function createRouterByHistory(history: RouterHistory): Router {


  return createRouter({


    history,


    routes


  })


}


```

ä¸Šé¢å¯¼å‡ºäº†ä¸€ä¸ªå«åš `createRouterByHistory` çš„æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª history ä½œä¸ºå‚æ•°ï¼Œæ¥ç€è°ƒç”¨ `createRouter` åˆ›å»ºè·¯ç”±ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›å­åº”ç”¨ä½œä¸ºå¾®åº”ç”¨åŠ è½½æ—¶ä½¿ç”¨ã€Œå†…å­˜è·¯ç”±ã€æ–¹æ¡ˆï¼Œè€Œå•ç‹¬ä½¿ç”¨æ—¶ç”¨ hash è·¯ç”±æ–¹æ¡ˆã€‚æ‰€ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•åŠ¨æ€åˆ›å»ºã€‚

æ¥ç€ï¼Œåœ¨å­åº”ç”¨å…¥å£æ–‡ä»¶ `main.ts` ä¸­:

```
import './public-path'


import 'core-js/stable'


import 'regenerator-runtime/runtime'


import { App as VueApp, createApp } from 'vue'


import App from './App.vue'


import { createMemoryHistory, createWebHashHistory } from 'vue-router'


import { createRouterByHistory } from './router/index'


import { name as appName } from '../package.json'


// åº”ç”¨æ˜¯å¦ä½œä¸ºå¾®åº”ç”¨åŠ è½½ï¼ˆåœ¨qiankunè¿è¡Œç¯å¢ƒå†…ï¼‰


const poweredByQiankun: boolean = (window as any).__POWERED_BY_QIANKUN__


// å¦‚æœæ˜¯ä½œä¸ºå¾®åº”ç”¨åŠ è½½ï¼Œä½¿ç”¨å†…å­˜è·¯ç”±ï¼Œå¦åˆ™ä½¿ç”¨ hash è·¯ç”±


const history = poweredByQiankun


  ? createMemoryHistory(`/${appName}/`) // ä½¿ç”¨ package.json ä¸­çš„ name å­—æ®µä½œä¸ºè·¯ç”±çš„ base, ä¸ä¸»åº”ç”¨ä¼ å…¥çš„ path å¯¹åº”


  : createWebHashHistory()


// ä¼ å…¥ historyï¼Œåˆ›å»ºè·¯ç”±


const router = createRouterByHistory(history)


interface QiankunProps {


  [k: string]: any


  path?: string


  container?: Element


}


// å…¨å±€å˜é‡ï¼ŒVue åº”ç”¨å®ä¾‹ï¼Œç”¨äºæ–¹ä¾¿åœ¨ unmount ä¸­è®¿é—®


let app: VueApp | null


// åº”ç”¨æ¸²æŸ“å‡½æ•°


function render(props: QiankunProps) {


  // ä¸»åº”ç”¨ä¼ è¿‡æ¥çš„åŠ è½½è·¯å¾„ï¼Œå¦‚æœä¸æ˜¯ä½œä¸ºå¾®åº”ç”¨è®¿é—®ï¼Œpathä¸º undefined


  const { path, container } = props


  // æ¯æ¬¡ render éƒ½é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨å®ä¾‹


  app = createApp(App)


  app.use(router).mount(container ? container.querySelector('#app') : '#app')


  // å¦‚æœä½œä¸ºå¾®åº”ç”¨åŠ è½½ï¼Œä¸”ä¸»åº”ç”¨ä¼ æ¥äº† path ,è·³è½¬åˆ°æ­¤ path (å†…å­˜è·¯ç”±)


  if (poweredByQiankun && path) {


    router.push(path)


  }


}


// ç‹¬ç«‹è¿è¡Œæ—¶,ç›´æ¥è°ƒç”¨ render æ–¹æ³•ï¼Œæ­£å¸¸æ¸²æŸ“åº”ç”¨


if (!poweredByQiankun) {


  render({})


}


/* ğŸ‘‡ qiankun å¾®åº”ç”¨é’©å­å‡½æ•° ğŸ‘‡ */


export async function bootstrap() {


  console.log('bootstrap')


}


export async function mount(props: QiankunProps) {


  render(props)


}


export async function unmount() {


  if (app) {


    app.unmount()


    app._container.innerHTML = ''


    app = null


    history.destroy()


  }


}


```

é‡ç‚¹æœ‰ä¸¤ä¸ªï¼š

1.  **åŠ¨æ€åˆ›å»ºè·¯ç”±**ã€‚æ ¹æ® `poweredByQiankun` æ ‡è¯†ï¼Œåˆ›å»ºä¸åŒçš„è·¯ç”±ã€‚å¦‚æœåº”ç”¨æ˜¯ä½œä¸ºå¾®åº”ç”¨åŠ è½½è¿è¡Œï¼Œè°ƒç”¨ `createMemoryHistory` åˆ›å»ºå†…å­˜è·¯ç”±ï¼Œå³åº”ç”¨çš„é¡µé¢è·³è½¬ä¸ä¼šååº”åˆ°æµè§ˆå™¨åœ°å€æ ä¸­ï¼›å¦‚æœå­åº”ç”¨ç‹¬ç«‹è¿è¡ŒåŠ è½½ï¼Œåˆ™è°ƒç”¨`createWebHashHistory`åˆ›å»º hash è·¯ç”±, ç¡®ä¿åœ¨å•ç‹¬ä½¿ç”¨å­åº”ç”¨çš„æ—¶å€™ï¼Œæœ‰æ­£å¸¸çš„æµè§ˆå™¨åœ°å€ä½œä¸ºè·³è½¬æ ‡è¯†
2.  **ç‹¬ç«‹çš„åº”ç”¨å®ä¾‹**ã€‚åœ¨ render æ–¹æ³•ä¸­ï¼Œæ¯æ¬¡éƒ½è°ƒç”¨ `createApp` é‡æ–°åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œç¡®ä¿æ¯ä¸ªé¡µç­¾ä¸­çš„åº”ç”¨æ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸ä¼šç›¸äº’å½±å“ã€‚æŠŠåˆ›å»ºçš„åº”ç”¨å®ä¾‹å­˜åœ¨ä¸€ä¸ªå…¨å±€å˜é‡é‡Œï¼Œæ˜¯ä¸ºäº† `unmount` å‹¾å­æ–¹æ³•å¯ä»¥è®¿é—®åˆ°ï¼Œä»è€Œå¸è½½åº”ç”¨

éƒ¨ç½²
--

éƒ¨ç½²æ–¹æ¡ˆè§†æƒ…å†µè€Œå®šã€‚ç”±äºåº”ç”¨åŠ è½½æ—¶ï¼Œä¸»åº”ç”¨éœ€è¦ç”¨ fetch æ–¹æ³•è¯·æ±‚å­åº”ç”¨çš„èµ„æºï¼Œæ‰€ä»¥å­åº”ç”¨éœ€è¦åšå¥½**è·¨åŸŸé…ç½®**ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨ NGINX é…ç½®å¦¥å½“å³å¯ã€‚
